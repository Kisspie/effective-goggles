<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ë°°ë“œë¯¼í„´ ëŒ€ì§„í‘œ & ì ìˆ˜ ê¸°ë¡</title>
<style>
body{font-family:'Noto Sans KR',sans-serif;margin:0;padding:20px;background:#f7fafc;}
.container{max-width:1200px;margin:0 auto;background:white;padding:20px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.05);}
input,select,button{padding:6px;margin:4px;border-radius:8px;border:1px solid #ccc;}
button{background:#2563eb;color:white;border:none;cursor:pointer;}
button:hover{background:#1d4ed8;}
.players,.match,.leftovers,.storage,.scores{margin-top:10px;padding:10px;border-radius:8px;}
.players{border:1px dashed #ccc;min-height:40px;}
.match{background:#e0f2fe;margin-bottom:8px;padding:8px;border-radius:8px;}
.leftovers{background:#fff3cd;border:1px solid #ffeeba;padding:8px;border-radius:8px;margin-top:10px;}
.court{font-weight:bold;}
.small{font-size:13px;color:#475569;margin-bottom:8px;}
.delete-btn{background:#dc2626;color:white;border:none;border-radius:4px;padding:2px 6px;font-size:12px;cursor:pointer;margin-left:4px;}
.delete-btn:hover{background:#b91c1c;}
input.score-input{width:50px;}
table{width:100%;border-collapse:collapse;margin-top:8px;}
th,td{padding:6px;border-bottom:1px solid #eee;text-align:left;}
.saved-item{display:inline-block;width:32%;margin:4px;padding:4px;border:1px solid #ccc;border-radius:6px;background:#f1f5f9;vertical-align:top;}
.saved-item button{margin-top:2px;padding:2px 6px;font-size:12px;display:block;width:100%;}
</style>
</head>
<body>
<div class="container">
<h1>ğŸ¸ ë°°ë“œë¯¼í„´ ëŒ€ì§„í‘œ & ì ìˆ˜ ê¸°ë¡</h1>

<div>
<input id="name" placeholder="ì´ë¦„ ì…ë ¥" />
<select id="age"><option>20ëŒ€</option><option>30ëŒ€</option><option>40ëŒ€</option><option>50ëŒ€</option><option>60ëŒ€</option></select>
<select id="gender"><option>ë‚¨ì</option><option>ì—¬ì</option></select>
<select id="group"><option>Aì¡°</option><option>Bì¡°</option><option>Cì¡°</option><option>Dì¡°</option><option>Eì¡°</option></select>
<input id="rating" type="number" min="0" max="100" placeholder="í‰ì (0~100)" style="width:100px;" />
<span class="small">Eì¡°(0~20) Dì¡°(21~40) Cì¡°(41~60) Bì¡°(61~80) Aì¡°(81~100), ê¸°ë³¸ê°’ ì¤‘ê°„ê°’</span>
<button onclick="addPlayer()">ì¶”ê°€</button>
</div>

<div class="players" id="playerList">ë“±ë¡ëœ ì„ ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.</div>

<div style="margin-top:12px;">
<select id="courtCount"><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option selected>8</option></select> ì½”íŠ¸
<button onclick="makeDraw(false)">ì „ì²´ ë°¸ëŸ°ìŠ¤ ëŒ€ì§„í‘œ ìƒì„±</button>
<button onclick="makeDraw(true)">ì¡°ë³„ ë°¸ëŸ°ìŠ¤ ëŒ€ì§„í‘œ ìƒì„±</button>
<button onclick="resetCourts()">ì½”íŠ¸ ì´ˆê¸°í™”</button>
<button onclick="resetCourtPlayers()">ì½”íŠ¸ ì¸ì› ì´ˆê¸°í™”</button>
</div>

<div id="leftoverPlayers" class="leftovers">ì´ë²ˆ ê²Œì„ ì°¸ì—¬ ëª»í•œ ì„ ìˆ˜: ì—†ìŒ</div>

<div class="storage">
<h3>ğŸ’¾ ì„ ìˆ˜ ëª…ë‹¨ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°</h3>
<input id="saveName" placeholder="ì €ì¥ ì´ë¦„ ì…ë ¥" />
<button onclick="savePlayers()">ì €ì¥</button>
<button onclick="addAllSavedToDraw()">ì €ì¥ ëª…ë‹¨ ì „ì²´ ëŒ€ì§„í‘œ ì¶”ê°€</button>
<div id="savedLists"></div>
</div>

<div id="draw"></div>

<div class="scores">
<h3>ğŸ“Š ì„ ìˆ˜ë³„ ëˆ„ì  ì ìˆ˜ & ì˜¤ëŠ˜ ê²Œì„ ì°¸ì—¬ íšŸìˆ˜ (ìµœëŒ€ 10ê²Œì„)</h3>
<div id="playerScores"></div>
</div>

<script>
let players=JSON.parse(localStorage.getItem('currentPlayers')||'[]');
let matchesData=JSON.parse(localStorage.getItem('matchesData')||'[]');
let playerScores=JSON.parse(localStorage.getItem('playerScores')||'{}');

function saveCurrent(){
  localStorage.setItem('currentPlayers',JSON.stringify(players));
  localStorage.setItem('matchesData',JSON.stringify(matchesData));
  localStorage.setItem('playerScores',JSON.stringify(playerScores));
}

function addPlayer(){
  let name=document.getElementById('name').value.trim();
  let age=document.getElementById('age').value;
  let gender=document.getElementById('gender').value;
  let group=document.getElementById('group').value;
  let rating=parseInt(document.getElementById('rating').value)||50;
  if(players.length>=50){ alert('ìµœëŒ€ 50ëª…ê¹Œì§€ ë“±ë¡ ê°€ëŠ¥í•©ë‹ˆë‹¤.'); return; }
  if(rating>=81) group='Aì¡°'; else if(rating>=61) group='Bì¡°'; else if(rating>=41) group='Cì¡°'; else if(rating>=21) group='Dì¡°'; else group='Eì¡°';
  players.push({name,age,gender,group,rating});
  document.getElementById('name').value='';document.getElementById('rating').value='';
  renderPlayers();saveCurrent();
}

function deletePlayer(index){ if(!confirm(players[index].name+' ì‚­ì œ?')) return; players.splice(index,1); renderPlayers(); saveCurrent(); }
function renderPlayers(){
  const list=document.getElementById('playerList');
  if(players.length===0){ list.innerHTML='ë“±ë¡ëœ ì„ ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.'; return; }
  list.innerHTML=players.map((p,i)=>`<div>${i+1}. ${p.name} (${p.age},${p.gender},${p.group},í‰ì :${p.rating})
  <button class='delete-btn' onclick='deletePlayer(${i})'>ì‚­ì œ</button></div>`).join('');
}

// ëŒ€ì§„í‘œ ìƒì„±
function shuffle(array){for(let i=array.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]];}return array;}
function makeDraw(byGroup){
  if(players.length<4){ alert('ìµœì†Œ4ëª… ì´ìƒ'); return; }
  let targetPlayers=players.slice();
  // ì§€ë‚œ ê²Œì„ ì°¸ì—¬ ëª»í•œ ì„ ìˆ˜ ìš°ì„  ë°°ì •
  let leftover=JSON.parse(localStorage.getItem('leftover')||'[]');
  let priority=targetPlayers.filter(p=>leftover.includes(p.name));
  let normal=targetPlayers.filter(p=>!leftover.includes(p.name));
  targetPlayers=priority.concat(normal);
  if(byGroup){let group=prompt('ì¡°(A~E)').toUpperCase(); targetPlayers=targetPlayers.filter(p=>p.group===group+'ì¡°');}
  targetPlayers=targetPlayers.sort((a,b)=>b.rating-a.rating);
  const matches=[];
  while(targetPlayers.length>=4 && matches.length<8){
    const t1=[targetPlayers.shift(),targetPlayers.pop()];
    const t2=[targetPlayers.shift(),targetPlayers.pop()];
    matches.push([t1,t2]);
  }
  leftover=targetPlayers.map(p=>p.name);
  localStorage.setItem('leftover',JSON.stringify(leftover));
  document.getElementById('leftoverPlayers').innerText='ì´ë²ˆ ê²Œì„ ì°¸ì—¬ ëª»í•œ ì„ ìˆ˜: '+(leftover.length? leftover.join(', '):'ì—†ìŒ');
  renderDraw(matches);
}

// ëŒ€ì§„í‘œ ë Œë”
function renderDraw(matchList){
  const draw=document.getElementById('draw'); matchesData=[]; draw.innerHTML='';
  matchList.forEach((m,i)=>{
    matchesData.push({team1:m[0],team2:m[1],score:[0,0]});
    let html=`<div class='match'><b>ê²½ê¸° ${i+1}</b>`;
    html+=`<div>${m[0].map(p=>p.name).join(', ')} VS ${m[1].map(p=>p.name).join(', ')}</div>`;
    html+=`<div>ì ìˆ˜: <input class='score-input' type='number' min='0' max='25' onchange='updateScore(${i},0,this.value)' /> :
           <input class='score-input' type='number' min='0' max='25' onchange='updateScore(${i},1,this.value)' /> ìŠ¹ë¦¬ í‘œì‹œ: <span id='win${i}'>-</span></div>`;
    html+='</div>'; draw.innerHTML+=html;
  });
  saveCurrent(); updatePlayerScores();
}

// ì ìˆ˜ ì—…ë°ì´íŠ¸
function updateScore(matchIndex,teamIndex,val){
  val=parseInt(val)||0; matchesData[matchIndex].score[teamIndex]=val;
  // ìŠ¹ë¦¬ í‘œì‹œ
  let winSpan=document.getElementById('win'+matchIndex);
  if(matchesData[matchIndex].score[0]>=25) winSpan.innerText='íŒ€1 ìŠ¹';
  else if(matchesData[matchIndex].score[1]>=25) winSpan.innerText='íŒ€2 ìŠ¹';
  else winSpan.innerText='-';
  updatePlayerScores(); saveCurrent();
}

// ì½”íŠ¸ ì´ˆê¸°í™”
function resetCourts(){
  if(!confirm('ì ìˆ˜ ìœ ì§€?')) playerScores={};
  matchesData=[]; renderDraw([]);
  saveCurrent(); renderPlayerScores();
}

// ì½”íŠ¸ ì¸ì› ì´ˆê¸°í™”
function resetCourtPlayers(){
  if(!confirm('ì´ë²ˆ ì½”íŠ¸ ë°°ì • ì„ ìˆ˜ ì‚­ì œ?')) return;
  let active=[]; matchesData.forEach(m=>m.team1.concat(m.team2).forEach(p=>active.push(p.name)));
  players=players.filter(p=>!active.includes(p.name));
  matchesData=[]; renderDraw([]); renderPlayers(); updatePlayerScores(); saveCurrent();
}

// ëˆ„ì  ì ìˆ˜ ë° ì°¸ì—¬íšŸìˆ˜
function updatePlayerScores(){
  Object.keys(playerScores).forEach(name=>{if(!playerScores[name]) playerScores[name]={scores:[],count:0};});
  matchesData.forEach(m=>{
    m.team1.forEach(p=>{
      if(!playerScores[p.name]) playerScores[p.name]={scores:[],count:0};
      playerScores[p.name].scores.push(m.score[0]); if(playerScores[p.name].scores.length>10) playerScores[p.name].scores.shift();
      playerScores[p.name].count++;
    });
    m.team2.forEach(p=>{
      if(!playerScores[p.name]) playerScores[p.name]={scores:[],count:0};
      playerScores[p.name].scores.push(m.score[1]); if(playerScores[p.name].scores.length>10) playerScores[p.name].scores.shift();
      playerScores[p.name].count++;
    });
  });
  renderPlayerScores();
}
function renderPlayerScores(){
  const div=document.getElementById('playerScores'); let html='<table><tr><th>ì´ë¦„</th><th>ì ìˆ˜ ë‚´ì—­</th><th>ì´ì </th><th>ì˜¤ëŠ˜ ê²Œì„ ì°¸ì—¬ íšŸìˆ˜</th></tr>';
  Object.keys(playerScores).sort().forEach(name=>{
    const s=playerScores[name].scores, total=s.reduce((a,b)=>a+b,0), count=playerScores[name].count;
    html+=`<tr><td>${name}</td><td>${s.join(', ')}</td><td>${total}</td><td>${count}</td></tr>`;
  }); html+='</table>'; div.innerHTML=html;
}

// ì´ˆê¸° ë Œë”ë§
renderPlayers(); updatePlayerScores();
</script>
</div>
</body>
</html>
